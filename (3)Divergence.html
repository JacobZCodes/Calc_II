<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Series Animation Example</title>
      <style>

        @font-face {
      font-family: 'TangoSans_Bold';
      src: url('tangosans/TangoSans_Bold.ttf') format('truetype');
    }
    body {
      background-color: #000;
      color: #00ccff;
      font-family: 'TangoSans_Bold', sans-serif;
      text-align: center;
      padding: 2em;
    }

    .hovered {
      text-decoration: underline;
      cursor: help;
      position: relative;
      color: #33ddff;
    }

    .hovered::after {
      content: attr(data-tooltip);
      position: absolute;
      background: #222;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      top: 1.5em;
      left: 0;
      font-size: 0.9em;
      white-space: nowrap;
      display: none;
      z-index: 10;
    }

    .hovered:hover::after {
      display: block;
    }

    button {
      margin-top: 1em;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: #000;
      background-color: #00ccff;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #00ccff;
    }

    button:active {
      transform: scale(0.95);
    }

    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #00ccff;
      border-radius: 5px;
      background-color: #111;
      color: #00ccff;
      width: 60%;
    }

    #sentences {
      margin-top: 1em;
    }

    #user-input {
      margin-top: 1em;
      display: none;
    }

    label {
      display: inline-block;
      margin-top: 0.5em;
      color: #00ccff
      ;
    }

      @keyframes fadeIn {
  to {
    opacity: 1;
  }
}

    @keyframes fadeOut {
        from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
  </style>
    <!-- âœ… MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <h1>Divergence</h1>
    <p id="sentence1"></p>
    <div id="sentences"></div>
    <div id="user-input-sequence" style="opacity: 0">
      <p>Enter a sequence of at least 5 numbers, separated by commas (arithmetic only):</p>
      <input type="text" id="sequenceInput" placeholder="e.g. 2, 4, 8, 16, 32">
      <button onclick="storeSequenceAndShowNext()">Input Sequence</button>
    </div>
    <div id="user-input-series" style="opacity:0">
      <p>Enter your sequence in series notation (please enter it exactly as a computer should read it, ie 2n+3 => 2*n+3):</p>
      <label>\( \sum_{n=1}^{\infty} \) <input type="text" id="seriesInput" placeholder="n^2">
      </label>
      <button onclick="storeSeriesAndShowNext()">Input Series</button>
    </div>


    <div id="user-input-psums" style="opacity: 0;">
      <p>Enter the partial sums for your series:</p>
      <label>S1 <input type="text" id="S1">
      </label>
      <label>S2 <input type="text" id="S2">
      </label>
      <label>S3 <input type="text" id="S3">
      </label>
      <label>S4 <input type="text" id="S4">
      </label>
      <label>S5 <input type="text" id="S5">
      </label>
      <button onclick="storePsumsAndShowNext()">Input Partial Sums</button>
    </div>
    <div id="user-input-guess" style="opacity: 0;">


    </div>
              <div id="explanation1" style="opacity: 0;"> <!--convergence vs divergence--> </div>

        <div id="graph-container" style="opacity: 0; justify-content: space-around; gap: 2em;">
      <div id="graph" style="flex: 1;"></div>
      <div id="div-guess" style="opacity: 0;"> K/div>

      <div id="graphMore" style="flex: 1; opacity: 0;"></div>
    </div>
    <div id="explanation2" style="opacity: 0;"> <!--convergence vs divergence-->
    </div>
    <div id="finalExplanation" style="opacity: 0;">
      <p>So it might seem that we can easily tell whether or not a series converges or diverges: we can just start computing partial sums and follow the pattern.
        But sometimes this pattern is not always obvious, or predictable, or easy at all to compute (give an example of such a difficult computation). So that is why mathematicians have created a series of tests
        to examine series in order that we do not need to sit all day computing partial sums. The first test is the <strong>divergence test</strong> LESSON DONE.
      </p>
    </div>
    <div id="divergenceExplain" style="opacity: 0;">
    </div>
    <script>
        function fadeIn(el) {
        el.style.opacity = "0";    

    el.style.animation = "fadeIn 0.6s forwards";
  }


    function fadeOut(el) {
    el.style.opacity = "1";    
    el.style.animation = "fadeOut 0.6s forwards";
  }
      function computePartialSum(n, series) { // computes S_n
          let sum = 0;
          for (let i = 1; i <= n; i++) {
            sum += series(i);
          }
          return sum;
      }

      function formatSentence(raw) {
        return raw.replace(/"([^"]+)"/g, (_, word) => underlineWord(word)).replace(/\n/g, ' < br > ');
      }
        const sentenceList = [];
        let currentIndex = -1;
        let userSequence = []; // Global list to store the sequence
        function storeSequenceAndShowNext() {
          const input = document.getElementById("sequenceInput").value;
          // Parse by either spaces OR commas
          userSequence = input.split(/[\s,]+/) // Split on space or comma
            .map(x => parseFloat(x)) // Convert strings to numbers
            .filter(x => !isNaN(x)); // Remove any non-numbers
          console.log("Parsed sequence:", userSequence);
          // Advance to next stage (optional)
          showNext();
        }
        let userSeries = []; // Global list to store the series
        function storeSeriesAndShowNext() {
          const input = document.getElementById("seriesInput").value;
          userSeries = input;
          console.log("User series: ", userSeries);
          showNext();
        }
        let userPsums = []

        function storePsumsAndShowNext() {
          const input = document.getElementById("S1").value;
          userPsums = [document.getElementById("S1").value, document.getElementById("S2").value,
            document.getElementById("S3").value, document.getElementById("S4").value, document.getElementById("S5").value
          ]
          console.log("User Psums: ", userPsums);
          showNext();
        }
        
        document.addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            if (currentIndex === -1) {
              showNext();
            }
            return
          }
          if (event.key === "Backspace") {
            if (currentIndex === -2) {
              currentIndex = -1;
              return
            }
            else {
              goBack();
            }
          }
        });
        
        function goBack() {
          console.log(currentIndex);
          currentIndex--;
          switch (currentIndex){
            case 7:
              break;
            case 6:
              break;
            case 5:
              break;
            case 4:
              break;
            case 3:
              break;
            case 2:
              break;
            case 1:
              break;
            case 0:
              break;
            case -1:
        const seqInput = document.getElementById('user-input-sequence');
        fadeOut(seqInput);
        seqInput.remove();
              break;
          }
        }

        function showNext() {
          console.log(currentIndex);
          currentIndex++;
          if (currentIndex == 0) {
                    // initial sequence entering + button
        const seqInput = document.getElementById('user-input-sequence');
        fadeIn(seqInput);
        // document.getElementById("sentences").appendChild(seqInput);
          }
          if (currentIndex == 1) { // series notation
            const seriesInput = document.getElementById('user-input-series');
            fadeIn(seriesInput);
            // document.getElementById("sentences").appendChild(seriesInput);
          }
          if (currentIndex == 2) { // psums 
            const psumsInput = document.getElementById('user-input-psums');
            fadeIn(psumsInput);
            // document.getElementById("sentences").appendChild(psumsInput);
          }
          if (currentIndex == 3) { // convergence vs divergence
            const explanation = document.getElementById("explanation1");
                        fadeIn(explanation);

            explanation.innerHTML = `
              <p>
                We can form a sequence of your partial sums: S: {${userPsums.join(", ")}}
                <br>
                If <em>this</em> sequence approaches infinity, we say your series <em>diverges</em>.
                Otherwise, we say your series <em>converges</em>
                <button onclick="showNext()">Plot Partial Sums!</button>
                
              </p>`;
            // document.getElementById("sentences").appendChild(explanation);
          }
          if (currentIndex == 5) { // guess
            const guessInput = document.getElementById('div-guess');
            guessInput.innerHTML = `
                  <p>What do you think the series will do?</p>
                  <label>
        <input type="radio" name="seriesGuess" value="converge"> Converge </label>
      <br>
      <label>
        <input type="radio" name="seriesGuess" value="diverge"> Diverge </label>
      <br>
      <button onclick="showNext()">Submit Guess</button>
            `

            fadeIn(guessInput);
            // document.getElementById("sentences").appendChild(guessInput);
          }
          if (currentIndex == 6) { // explain divergence more
            fadeIn(divergenceExplain);
            divergenceExplain.innerHTML = `      <p> It's a bit hard to tell just from graphing the first five terms whether or not the series will converge or diverge. Here is your graph with some more partial sums computed: </p>
 <br> <button onclick="showNext()">Show Graph</button>`
            // document.getElementById('sentences').appendChild(divergenceExplain);
          }
          if (currentIndex == 4) { // graph user
            console.log("here");
            const graphContainer = document.getElementById('graph-container');
            const graph = document.getElementById('graph');
            console.log("t1");
            fadeIn(graphContainer);
            console.log("t2");
            fadeIn(graph);
            console.log("t3");

            // document.getElementById("sentences").appendChild(graph);
            const nextBtn = document.createElement("button");
            nextBtn.textContent = "Continue";
            nextBtn.onclick = showNext;
            // document.getElementById("sentences").appendChild(nextBtn);
            const xVals = userPsums.map((_, i) => i + 1);
            const yVals = userPsums.map(val => parseFloat(val)).filter(v => !isNaN(v));
Plotly.newPlot('graph', [{
  x: xVals,
  y: yVals,
  mode: 'markers',
  type: 'scatter',
  marker: {
    size: 8,
    color: '#00ccff'
  }
}], {
  title: {
    text: `Scatter Plot of ${userSeries}`,
    font: { color: '#00ccff' }
  },
  plot_bgcolor: '#111',
  paper_bgcolor: '#000',
  font: { color: '#00ccff' },
  xaxis: {
    title: { text: 'S_n', font: { color: '#00ccff' } },
    dtick: 1,
    gridcolor: '#333',
    zerolinecolor: '#555',
    linecolor: '#00ccff',
    tickcolor: '#00ccff'
  },
  yaxis: {
    title: { text: 'Series Value', font: { color: '#00ccff' } },
    dtick: 1,
    gridcolor: '#333',
    zerolinecolor: '#555',
    linecolor: '#00ccff',
    tickcolor: '#00ccff'
  }
});

          }
          if (currentIndex == 7) { // graph user + more points
            const graphMore = document.getElementById('graphMore');
            const graphContainer = document.getElementById('graph-container');
           fadeIn(graphMore);
            graphContainer.style.display = 'flex'; // âœ… make it visible
            // document.getElementById("sentences").appendChild(graphContainer);
            const nextBtn = document.createElement("button");
            nextBtn.textContent = "Continue";
            nextBtn.onclick = showNext;
            // document.getElementById("sentences").appendChild(nextBtn);
            const xVals = Array.from({
              length: 30
            }, (_, i) => i + 1);
            let yVals = [];
            try {
              const seriesFunc = new Function("n", "return " + userSeries);
              yVals = xVals.map(n => computePartialSum(n, seriesFunc));
            } catch (e) {
              alert("There was an error parsing your series function.");
              console.error(e);
            }
Plotly.newPlot('graphMore', [{
  x: xVals,
  y: yVals,
  mode: 'markers',
  type: 'scatter',
  marker: {
    size: 8,
    color: '#00ccff'
  }
}], {
  title: {
    text: `Scatter Plot of ${userSeries}`,
    font: { color: '#00ccff' }
  },
  plot_bgcolor: '#111',
  paper_bgcolor: '#000',
  font: { color: '#00ccff' },
  xaxis: {
    title: { text: 'S_n', font: { color: '#00ccff' } },
    dtick: 1,
    gridcolor: '#333',
    zerolinecolor: '#555',
    linecolor: '#00ccff',
    tickcolor: '#00ccff'
  },
  yaxis: {
    title: { text: 'Series Value', font: { color: '#00ccff' } },
    dtick: 1,
    gridcolor: '#333',
    zerolinecolor: '#555',
    linecolor: '#00ccff',
    tickcolor: '#00ccff'
  }
});


;
          }
           if (currentIndex == 8) { // final explaination
            fadeIn(finalExplanation);
            // document.getElementById("sentences").appendChild(finalExplanation);
          }
          if (currentIndex < sentenceList.length) {
            const p = document.createElement("p");
            p.innerHTML = formatSentence(sentenceList[currentIndex]);
            // document.getElementById("sentences").appendChild(p);
            MathJax.typeset(); // Re-render LaTeX after update
          }
        }
    </script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  </body>
</html>