<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Power Series</title>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <style>
    @font-face {
      font-family: 'TangoSans_Bold';
      src: url('tangosans/TangoSans_Bold.ttf') format('truetype');
    }
    body {
      background-color: #000;
      color: #00ccff;
      font-family: 'TangoSans_Bold', sans-serif;
      text-align: center;
      padding: 2em;
    }
    .box {
  display: flex;
  flex-direction: column;
  width: 200px;
  /* margin: 0 auto; */
  align-items: center;
  border: 2px solid #00ccff;
  border-radius: 10px;
  padding: 1.5em;
  background-color: #111;
  box-shadow: 0 0 12px #00ccff55;
}


      .question {
        display: flex;
        align-items: center;
        gap: 0.5em;
      }


            input[type="text"] {
        background-color: #111;
        /* dark input background */
        color: #00ccff;
        /* cyan text color */
        border: 1px solid #00ccff;
        /* cyan border */
        border-radius: 4px;
        /* rounded corners */
        padding: 10px 12px;
        font-size: 16px;
        width: 20%;
        height: 3px;
        box-shadow: 0 0 8px #00ccff33;
        /* subtle cyan glow */
        outline: none;
        transition: box-shadow 0.3s ease, border-color 0.3s ease;
      }

      input[type="text"]:focus {
        border-color: #33ffff;
        box-shadow: 0 0 12px #33ffff;
      }

       button {
      margin-top: 1em;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: #000;
      background-color: #00ccff;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
      animation: fadeIn 1s forwards;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #00ccff;
      /* animation: fadeIn 1s forwards; */
    }

    button:active {
      transform: scale(0.95);
      /* animation: fadeIn 1s forwards; */
    }

    
      
  </style>
</head>
<body>
  <h2>Power Series</h2>


<div class="lesson">
<p>A series is a summation: \( \sum_{n=1}^{\infty} a_n \)</p>

<p>
  A power series is a series where each term includes a power of \( x \): 
  \( \sum_{n=1}^{\infty} a_n x^n \). We say this series is 
  <strong>centered</strong> at \( x = 0 \).
</p>

<p>
  But the series \( \sum_{n=1}^{\infty} a_n (x - a)^n \) is 
  <strong>centered</strong> at \( x = a \).
</p>

<div id="student-work" style="display: flex; justify-content: center; align-items: center; position: relative; gap: 5px;
left: 50px;">
  <div id="yourTurn" class="box">
    <h3 style="padding-bottom: 0.5em;">Your Turn</h3>
    <p>Create a power series of the form \( \sum_{n=1}^{\infty} a_n (x - a)^n \)</p>
    <div id="question">
      <label id= "label-an" for="sequence">\(a_n=\)</label>
      <input id="sequence" type="text">
    </div>
    <div id="question">
    <span>\( (x - \)</span>
    <input id="center" type="text">
    <span>\()^n \)</span>
    <div id="button-space" style="width:150px; margin: 0 auto; padding-top: 10px;">
      <button id="submitPowerSeriesBtn" style="position: relative;">Submit Power Series</button>
    </div>
    </div>
  </div>
  <div id="latexSection" style="display:flex;">
    <div id="generalSeriesSection">
      <div id="generalSeries">
      </div>
      <div id="termSlider" style="display:flex; flex-direction: column; align-items: center;">
          <input  width=50px; type="range" id="n-slider" min="0" max="5" value="0"><br>
          <label id="n-slider-label" for="n-slider">n = 0</label>
          <div id="xInputSection" style="display:flex; flex-direction: row; align-items: center; justify-content: center;">
              <label id= "x-label" for="x">x =  </label>
              <input id="x" type="text" style="width: 10px; margin-left: 0.25em;">
          </div>
          <button id="evaluate-polynomial-btn" style="position: relative; width: 100px; font-size: smaller; text-align: center;">Submit</button>      
      </div>
    </div>

    <div id="expandedSection" style="width: 575px; justify-content: flex-start; display: flex;"></div>
    <div id="evaluationSection" style="padding-left: 1em;">
      <!-- <p>dummy text</p> -->
    </div>    


  </div>
</div>
</div>
  <script>
    let sequence; // a_n = ...
    let center; // a
    let centerExpression; // (x-a)
    let latexList = []; // [a1 * (x-a)^1, a2 * (x-a)^2, a3 * (x-a)^3]
    let latexExpression;
    let generalSeries = document.getElementById("generalSeries");
    let expandedSection = document.getElementById("expandedSection");
    let nSliderLabel = document.getElementById("n-slider-label");
    let evaluationSection = document.getElementById("evaluationSection");
    let strippedLatexList;
    let xVal;
    let innerHTMLWithXValue;


    document.getElementById("evaluate-polynomial-btn").addEventListener("click", function() {
      // get strippedLatexList and join it together
      innerHTMLWithXValue = `\\( ${strippedLatexList.join(' + ')} \\)`;
      xVal = parseInt( document.getElementById("x").value);
      // replace all instances of variable "x" in the latex and display
      innerHTMLWithXValue = innerHTMLWithXValue.replace(/\bx\b/g, `(${xVal})`);
      // console.log(temp);
      expandedSection.innerHTML = innerHTMLWithXValue;
      // evaluate at current n-label n
      let currentN = parseInt(nSliderLabel.innerText.replace(/[^\d\-]/g, ''), 10);
      
      evaluationSection.innerText = evaluatePolynomial(xVal,currentN);
      MathJax.typeset();
    })


  document.getElementById("n-slider").addEventListener("input", function () { 
  // clean n
  let n = parseInt(this.value);
  // update visual on the slider
  nSliderLabel.innerText = `n = ${n}`;
  // build displayHTML
  buildLatexListUpToN(n, sequence, center);
  strippedLatexList = stripLatexList();
  let displayHTML = `\\( ${strippedLatexList.join(' + ')} \\)`;
  if (!xVal){
    expandedSection.innerHTML = displayHTML;
  }
  else {
      // append summation to last element in latex list
      let summationResult = evaluatePolynomial(xVal,n);
      appendResultToEndOfLatexList(summationResult);
      strippedLatexList = stripLatexList();
      displayHTML = `\\( ${strippedLatexList.join(' + ')} \\)`;
      displayHTML.replace(/\bx\b/g, `(${xVal})`); 
      expandedSection.innerHTML = displayHTML;
  }
  MathJax.typeset();  
  });

  document.getElementById("submitPowerSeriesBtn").addEventListener("click", function() {
    // TO DO: sanitize values
    // collect values
    sequence = document.getElementById("sequence").value;
    center = parseInt(document.getElementById("center").value);
    // return values as latex
    generalSeries.innerHTML = buildInitialLatex(sequence, center);
    MathJax.typeset();
  }
  )
    function appendResultToEndOfLatexList(result) {
      let indexOfLastLatexElement = latexList.length - 1;
      let lastLatexElement = latexList[indexOfLastLatexElement];
      console.log("Last element: ", lastLatexElement);
      latexList[indexOfLastLatexElement].replace(/\^(\d+)(?=\s*\\\))/g, `^$1 = ${result}`);;
    }
    function computeCenterExpression(xVal, center, n) {
      return (xVal - center) ** n;
    }

    function computeSequenceExpression(n) {
      let seqAsFunc = new Function("n", `return ${sequence};`);
      return seqAsFunc(n);
    }

    function evaluatePolynomial(xVal, n) {
      let rollingSum = 0;
      let summandList = [];
      for (let i=1; i<=n; ++i) {
        summandList[i-1] = computeSequenceExpression(i) * computeCenterExpression(xVal, center,i)
        
        rollingSum += summandList[i-1];
      }
      return rollingSum;
      
    }
    function buildCenterExpressionWithoutNPower(center){
      centerExpression = center === 0
      ? "x"
      : center > 0
        ? `(x - ${center})`
        : `(x + ${Math.abs(center)})`;
      return centerExpression;
    }

    function stripLatexList() {
      return latexList.map(s => s.replace(/^\\\(|\\\)$/g, ''));
    }
    function replaceNInSequenceWithVariable(n, sequence) {
      return sequence.replace(/n/g,n);
    }


    function buildInitialLatex(sequence, center) {
      // don't variaibilze n since we're displaying sequence as is
      centerExpression = buildCenterExpressionWithoutNPower(center);
      const latex = `\\( \\sum_{n=1}^{\\infty} ${sequence} \\cdot ${centerExpression}^n = \\)`;
      return `<div>${latex}</div>`;
    }


    function buildLatexForGivenN(n,sequence, center) {
      clean_sequence = replaceNInSequenceWithVariable(n,sequence);
     
      const latex = `\\(${clean_sequence} \\cdot ${centerExpression}^${n} \\)`;
      return latex;
    }

    function buildLatexListUpToN(n,sequence, center) {
      // reset latexList
      latexList = [];
      for (let i=1; i<=n; ++i) {
        latexList[i-1] = buildLatexForGivenN(i,sequence,center)
      }
    }
          
  </script>
</body>
</html>

<!-- <p>But what does it even mean for the series to be <em>centered</em> <a target="_blank" href="https://www.desmos.com/calculator/gy6tkj8sjw">somewhere?</a></p>
<p>Please work through the next two Desmos links in order</p>
<a href="https://www.desmos.com/calculator/hfxi3fttky" target="_blank">Power Series: Where Does it Converge?</a><br>
<a href="https://www.desmos.com/calculator/vdjbwpn07h" target="_blank">Power Series: Visualizing Interval of Convergence</a> -->
