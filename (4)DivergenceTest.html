<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Series Animation Example</title>
    <style>
      .hovered {
        text-decoration: underline;
        cursor: help;
        position: relative;
      }

      .hovered::after {
        content: attr(data-tooltip);
        position: absolute;
        background: #333;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        top: 1.5em;
        left: 0;
        font-size: 0.9em;
        white-space: nowrap;
        display: none;
        z-index: 10;
      }

      .hovered:hover::after {
        display: block;
      }

      #sentences {
        margin-top: 1em;
      }

      #user-input {
        margin-top: 1em;
        display: none;
      }
    </style>
    <!-- âœ… MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <h1>Divergence Test</h1>
    <div id="divergence-test" style="display: none"></div>
    <div id="converse" style="display: none"></div>
    <!-- Add this slider inside <body> -->
    <div id="slider-container" style="display:none; margin-top: 1em;">
      <label for="term-slider">Number of Terms: <span id="term-count">1</span></label>
      <input type="range" id="term-slider" min="1" max="1000" value="1">
    </div>
    <canvas id="stacked-box-canvas" width="400" height="600" style="display:none; border:1px solid #000;"></canvas>
    <script>
      const divergenceTest = document.getElementById('divergence-test');
      divergenceTest.innerHTML = `**If \\(a_n \\not\\to 0\\), then \\(\\sum a_n\\) diverges.** 
				<button onclick="showConverse()">Continue</button>`;
      divergenceTest.style.display = 'block';
      MathJax.typeset();

      function showConverse() {
        const converse = document.getElementById('converse');
        converse.innerHTML = `What this doesn't mean: **If \\(a_n \\to 0\\), then \\(\\sum a_n\\) converges.**
				<button onclick="showDivergenceGraph()">Continue</button>`;
        converse.style.display = 'block';
        MathJax.typeset()
      };

function showDivergenceGraph() {
  const canvas = document.getElementById('stacked-box-canvas');
  const sliderContainer = document.getElementById('slider-container');
  const slider = document.getElementById('term-slider');
  const termCountLabel = document.getElementById('term-count');

  canvas.style.display = 'block';
  sliderContainer.style.display = 'block';

  const ctx = canvas.getContext('2d');
  const a_n = (n) => Math.pow(1.01, n - 1);
  const boxWidth = 100;
  const baseX = canvas.width / 2 - boxWidth / 2;

  let boxes = [];
  let currentTermCount = 1;

  function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function updateBoxes(n) {
    boxes = [];
    let y = canvas.height;
    for (let i = 1; i <= n; i++) {
      const value = a_n(i);
      boxes.push({ index: i, value, targetHeight: value, currentHeight: 0, y }); // currentHeight animates up
      y -= 1; // initial dummy height, gets fixed during animation
    }
  }

  function animate() {
    clearCanvas();

    // Determine dynamic scale to fit everything
    const totalHeight = boxes.reduce((sum, box) => sum + box.value, 0);
    const scaleY = canvas.height / (totalHeight * 1.1); // pad by 10%
    let y = canvas.height;

    // Update and draw each box
    for (let box of boxes) {
      const fullHeight = box.value * scaleY;
      if (box.currentHeight < fullHeight) {
        box.currentHeight += (fullHeight - box.currentHeight) * 0.1; // smooth step up
        if (Math.abs(fullHeight - box.currentHeight) < 0.5) {
          box.currentHeight = fullHeight;
        }
      }

      y -= box.currentHeight;

      ctx.fillStyle = 'rgba(0, 100, 255, 0.6)';
      ctx.fillRect(baseX, y, boxWidth, box.currentHeight);

      ctx.strokeStyle = 'black';
      ctx.lineWidth = 1;
      ctx.strokeRect(baseX, y, boxWidth, box.currentHeight);

      ctx.fillStyle = 'black';
      ctx.font = '12px sans-serif';
      ctx.fillText(`a_${box.index} = ${box.value.toFixed(2)}`, baseX + 5, y + 16);
    }

    requestAnimationFrame(animate);
  }

  // Initial
  updateBoxes(currentTermCount);
  animate();

  // Slider interaction
  slider.addEventListener('input', () => {
    const n = parseInt(slider.value);
    termCountLabel.textContent = n;
    if (n !== currentTermCount) {
      currentTermCount = n;
      updateBoxes(n);
    }
  });
}




    </script>
  </body>
</html>