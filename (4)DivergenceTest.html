<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Series Animation Example</title>
<style>
    @font-face {
      font-family: 'TangoSans_Bold';
      src: url('tangosans/TangoSans_Bold.ttf') format('truetype');
    }
    body {
      background-color: #000;
      color: #00ccff;
      font-family: 'TangoSans_Bold', sans-serif;
      text-align: center;
      padding: 2em;
    }

      @keyframes fadeIn {
  to {
    opacity: 1;
  }
}

    @keyframes fadeOut {
        from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
  .hovered {
    text-decoration: underline;
    cursor: help;
    position: relative;
    color: #33ddff;
  }

  .hovered::after {
    content: attr(data-tooltip);
    position: absolute;
    background: #222;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    top: 1.5em;
    left: 0;
    font-size: 0.9em;
    white-space: nowrap;
    display: none;
    z-index: 10;
  }

  .hovered:hover::after {
    display: block;
  }

  button {
    margin-top: 1em;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: bold;
    color: #000;
    background-color: #00ccff;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #00ccff;
  }

  button:active {
    transform: scale(0.95);
  }

  input[type="range"] {
    width: 60%;
    margin-top: 1em;
    accent-color: #00ccff;
  }

  #sentences {
    margin-top: 1em;
  }

  #user-input {
    margin-top: 1em;
    display: none;
  }

  #canvas-wrapper,
  #canvas-wrapper-1,
  #canvas-wrapper-2 {
    border: 1px solid #00ccff;
    background-color: #111;
  }

  #graph-explanation {
    color: #00ccff;
  }

  label {
    color: #00ccff;
    font-weight: bold;
  }
</style>

    <!-- ✅ MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <h1>Divergence Test</h1>
    <div id="divergence-test" style="opacity: 0;"></div>
    <div id="converse" style="opacity: 0;"></div>
    <div id="slider-container" style="opacity: 0; margin-top: 1em">
      <label for="term-slider">Number of Terms: <span id="term-count">1</span>
      </label>
      <input type="range" id="term-slider" min="1" max="1000" value="1" />
    </div>
    <!-- <div id="canvas-wrapper">
      <canvas id="stacked-box-canvas" width="400" height="3000"></canvas>
    </div> -->
    <div style="display: flex; gap: 1em; margin-top: 1em;">
  <div style="display: flex; flex-direction: column; align-items: center;">
    <h3 id="canvas1-title"style="color: #00ccff; margin-bottom: 0.3em;">Divergent Series: \\(a_n = 1.01^{n-1}\\)</h3>
    <div id="canvas-wrapper-1" style="width: 420px; height: 600px; overflow-y: scroll; border: 1px solid black; display: none;">
      <canvas id="stacked-box-canvas-1" width="400" height="3000"></canvas>
    </div>
  </div>
  <div style="display: flex; flex-direction: column; align-items: center;">
    <h3 id="canvas2-title" style="color: #00ccff; margin-bottom: 0.3em;">Convergent Series: \\(a_n = 0.99^{n-1}\\)</h3>
    <div id="canvas-wrapper-2" style="width: 420px; height: 600px; overflow-y: scroll; border: 1px solid black; display: none;">
      <canvas id="stacked-box-canvas-2" width="400" height="3000"></canvas>
    </div>
    <button id="canvas2-button" style="margin-top: 0.5em; opacity:0;" onclick="explainGraphs()">Continue</button>
    <p id="graph-explanation" style="opacity:0; max-width: 400px; margin-top: 0.5em; text-align: center;">
      Even though \\(a_n \\to 0\\), the right-hand series (with \\(a_n = 0.99^{n-1}\\)) converges, while the left-hand one (with \\(a_n = 1.01^{n-1}\\)) diverges because the terms don't shrink to zero. This illustrates that the divergence test only tells us when a series definitely diverges — not when it converges DONE.
    </p>
  </div>
</div>

  <div id="canvas-wrapper-1" style="width: 420px; height: 600px; overflow-y: scroll; border: 1px solid black; opacity: 0;">
    <canvas id="stacked-box-canvas-1" width="400" height="3000"></canvas>
  </div>
  <div style="display: flex; flex-direction: column; align-items: center;">
  <div id="canvas-wrapper-2" style="width: 420px; height: 600px; overflow-y: scroll; border: 1px solid black; opacity: 0;">
    <canvas id="stacked-box-canvas-2" width="400" height="3000"></canvas>
  </div>
  <button id="canvas2-button" style="margin-top: 0.5em; opacity:0;" onclick="explainGraphs()">Continue</button>
  <p id="graph-explanation" style="opacity: 0; max-width: 400px; margin-top: 0.5em; text-align: center;">
  Even though \\(a_n \\to 0\\), the right-hand series (with \\(a_n = 0.99^{n-1}\\)) converges, while the left-hand one (with \\(a_n = 1.01^{n-1}\\)) diverges because the terms don't shrink to zero. This illustrates that the divergence test only tells us when a series definitely diverges — not when it converges DONE.
</p>

</div>

</div>
<script>

let currentIndex = -1;
document.addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            if (currentIndex === -1) {
              showNext();
            }
            return
          }
          if (event.key === "Backspace") {
            if (currentIndex === -2) {
              currentIndex = -1;
              return
            }
            else {
              goBack();
            }
          }
        });
   function fadeIn(el) {
        el.style.opacity = "0";    

    el.style.animation = "fadeIn 0.6s forwards";
  }


    function fadeOut(el) {
    el.style.opacity = "1";    
    el.style.animation = "fadeOut 0.6s forwards";
  }
  function explainGraphs() {
    const para = document.getElementById("graph-explanation");
    para.style.display = "block";
    MathJax.typeset();
  }

  function showNext() {
    currentIndex++;
    console.log(currentIndex);
    if (currentIndex === 0) {
      const divergenceTest = document.getElementById("divergence-test");
      divergenceTest.innerHTML = `**If \\(a_n \\not\\to 0\\), then \\(\\sum a_n\\) diverges.** <button onclick="showNext()">Continue</button>`;
      fadeIn(divergenceTest);
      MathJax.typeset();
    }
    
    if (currentIndex === 1) {
    const converse = document.getElementById("converse");
    converse.innerHTML = `What this doesn't mean: **If \\(a_n \\to 0\\), then \\(\\sum a_n\\) converges.**
      <button onclick="showNext()">Continue</button>`;
    fadeIn(converse);
    MathJax.typeset();
    }

    if (currentIndex === 2) {
    const converse = document.getElementById("converse");
    converse.innerHTML = `What this doesn't mean: **If \\(a_n \\to 0\\), then \\(\\sum a_n\\) converges.**
      <button onclick="showNext()">Continue</button>`;
    fadeIn(converse);
    MathJax.typeset();
    }

    if (currentIndex === 3) {
      showDivergenceGraph();
    }
  }


  function showDivergenceGraph() {
    const canvas1 = document.getElementById("stacked-box-canvas-1");
    const canvas2 = document.getElementById("stacked-box-canvas-2");
    const wrapper1 = document.getElementById("canvas-wrapper-1");
    const wrapper2 = document.getElementById("canvas-wrapper-2");
    const sliderContainer = document.getElementById("slider-container");
    const slider = document.getElementById("term-slider");
    const termCountLabel = document.getElementById("term-count");

    wrapper1.style.display = "block";
    wrapper2.style.display = "block";
    document.getElementById("canvas2-button").style.display = "inline-block";
    sliderContainer.style.display = "block";
    MathJax.typeset(); 


    const contexts = [
      { canvas: canvas1, ctx: canvas1.getContext("2d"), a_n: n => Math.pow(1.01, n - 1) },
      { canvas: canvas2, ctx: canvas2.getContext("2d"), a_n: n => Math.pow(0.99, n - 1) }
    ];

    const boxWidth = 100;
    let currentTermCount = 1;
    const baseX = 150;

    const states = contexts.map(() => ({ boxes: [] }));
    let globalMaxTotalHeight = 0;

    function clearCanvas(ctx, canvas) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function computeGlobalMaxHeight(n) {
      const totals = contexts.map(({ a_n }) =>
        Array.from({ length: n }, (_, i) => a_n(i + 1)).reduce((a, b) => a + b, 0)
      );
      globalMaxTotalHeight = Math.max(...totals);
    }

    function updateBoxes(index, n) {
      const { a_n } = contexts[index];
      const boxes = [];
      for (let i = 1; i <= n; i++) {
        const value = a_n(i);
        boxes.push({ index: i, value, targetHeight: value, currentHeight: 0 });
      }
      states[index].boxes = boxes;
      computeGlobalMaxHeight(n);
    }

    function animate(index) {
      const { ctx, canvas } = contexts[index];
      const boxes = states[index].boxes;

      clearCanvas(ctx, canvas);

      const scaleY = canvas.height / (globalMaxTotalHeight * 1.1);
      let y = canvas.height;

      for (let box of boxes) {
        const fullHeight = box.value * scaleY;
        if (box.currentHeight < fullHeight) {
          box.currentHeight += (fullHeight - box.currentHeight) * 0.1;
          if (Math.abs(fullHeight - box.currentHeight) < 0.5) {
            box.currentHeight = fullHeight;
          }
        }

        y -= box.currentHeight;

        ctx.fillStyle = "rgba(0, 100, 255, 0.6)";
        ctx.fillRect(baseX, y, boxWidth, box.currentHeight);

        ctx.strokeStyle = "black";
        ctx.lineWidth = 1;
        ctx.strokeRect(baseX, y, boxWidth, box.currentHeight);

        ctx.fillStyle = "black";
        ctx.font = "12px sans-serif";
        ctx.fillText(`a_${box.index} = ${box.value.toFixed(2)}`, baseX + 5, y + 16);
      }

      requestAnimationFrame(() => animate(index));
    }

    // Initialize both graphs
    [0, 1].forEach(i => {
      updateBoxes(i, currentTermCount);
      animate(i);
    });
    // Initialize canvas titles
document.getElementById("canvas1-title").innerHTML = `\\(a_1 = 1.0000\\)`;
document.getElementById("canvas2-title").innerHTML = `\\(a_1 = 1.0000\\)`;
MathJax.typeset();


slider.addEventListener("input", () => {
  const n = parseInt(slider.value);
  termCountLabel.textContent = n;

  // Update canvas titles with a_n values
  const a1 = Math.pow(1.01, n - 1).toFixed(4);
  const a2 = Math.pow(0.99, n - 1).toFixed(4);
  document.getElementById("canvas1-title").innerHTML = `\\(a_${n}= ${a1}\\not\\to 0\\), then \\(\\sum a_n\\) diverges`;
  document.getElementById("canvas2-title").innerHTML = `\\(a_${n} = ${a2}\\to 0\\), then \\(\\sum a_n\\) ?`;
  MathJax.typeset();

  if (n !== currentTermCount) {
    currentTermCount = n;
    [0, 1].forEach(i => updateBoxes(i, n));
  }
});

  }
</script>

  </body>
</html>