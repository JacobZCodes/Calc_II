<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Series Animation Example</title>
<style>
    @font-face {
      font-family: 'TangoSans_Bold';
      src: url('tangosans/TangoSans_Bold.ttf') format('truetype');
    }
    body {
      background-color: #000;
      color: #00ccff;
      font-family: 'TangoSans_Bold', sans-serif;
      text-align: center;
      padding: 2em;
    }

      @keyframes fadeIn {
  to {
    opacity: 1;
  }
}

    @keyframes fadeOut {
        from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
  .hovered {
    text-decoration: underline;
    cursor: help;
    position: relative;
    color: #33ddff;
  }

  .hovered::after {
    content: attr(data-tooltip);
    position: absolute;
    background: #222;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    top: 1.5em;
    left: 0;
    font-size: 0.9em;
    white-space: nowrap;
    display: none;
    z-index: 10;
  }

  .hovered:hover::after {
    display: block;
  }

  button {
    margin-top: 1em;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: bold;
    color: #000;
    background-color: #00ccff;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #00ccff;
  }

  button:active {
    transform: scale(0.95);
  }

  /* input[type="range"] {
    width: 100%;
    margin-top: 1em;
    accent-color: #00ccff;
  } */

  #sentences {
    margin-top: 1em;
  }

  #user-input {
    margin-top: 1em;
    display: none;
  }


  #graph-explanation {
    color: #00ccff;
  }

  label {
    color: #00ccff;
    font-weight: bold;
  }

  .red {
  color: #ff4d4d; /* light red text */
  padding-left: 0.4em;

}

  .yellow {
  color:lightyellow; /* light red text */
  padding-left: 0.4em;
}

  .green {
  color:lightgreen; /* light red text */
  padding-left: 0.4em;
}


  .purple {
  color: purple; /* light red text */
  padding-left: 0.4em;
}

input[type="text"] {
  background-color: #111;         /* dark input background */
  color: #00ccff;                 /* cyan text color */
  border: 1px solid #00ccff;      /* cyan border */
  border-radius: 4px;             /* rounded corners */
  padding: 10px 12px;
  font-size: 16px;
  width: 10%;
  box-shadow: 0 0 8px #00ccff33;  /* subtle cyan glow */
  outline: none;
  transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

input[type="text"]:focus {
  border-color: #33ffff;
  box-shadow: 0 0 12px #33ffff;
}


select {
  background-color: #111;
  color: #00ccff;
  border: 1px solid #00ccff;
  border-radius: 4px;
  padding: 8px 10px;
  font-family: 'TangoSans_Bold', sans-serif;
  font-size: 16px;
  box-shadow: 0 0 8px #00ccff33;
  outline: none;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  appearance: none; /* removes default arrow styling */
}

select:focus {
  border-color: #33ffff;
  box-shadow: 0 0 12px #33ffff;
}

option {
  background-color: #111;
  color: #00ccff;
}







</style>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
     <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <h1>Divergence Test</h1>
    <div id="sentence1" style="opacity: 0;"><p><strong>If \(a_n \not\to 0\), then \(\sum a_n\) diverges.</strong></p> </div>
    <div id="sentence2" style="opacity: 0;"><p>What this doesn't mean: <span class="red"><strong>if \(a_n \to 0\), then \(\sum a_n\) converges</strong>.</p></span></div>
    <div id="sentence3" style="opacity: 0;"><p>Moreover, if  <span class="red">\(a_n \to 0\),</span><span class="yellow"><strong>then \(\sum a_n\) can either diverge or converge</strong>.</p></span></div>
    <div id="input1" style="opacity:0";>
      <p>Enter your sequence in series notation (please enter it exactly as a computer should read it, ie 2n+3 => 2*n+3):</p>
      <label>\( \sum_{n=1}^{\infty} \) <input type="text" id="seriesInput" placeholder="n^2">
      </label>
      <button id="seriesInputBtn">Input Series</button>
    </div>
<div id="area1" style="display: flex; align-items: center; position:relative; opacity: 0;">
  <div id="plotSpace1" style="position: relative;display: flex; margin-top: 2em; flex-direction: column; height: 350px;"  >
    <div id="label-row" style="display: flex; align-items: center; z-index: 10; align-content: baseline;">
      <div id="slider-wrapper" style="height: fit-content; width: fit-content; line-height: 1; margin: 0 auto; z-index: 10; position: relative;top: 40px; left: 200px;">
          <label id="plot1-label" for="n-slider"><span id="n-value-label">a_n = n</span></label><br>
          <input  width=50px; type="range" id="n-slider" min="1" max="100" value="20">
      </div>

      <div id="quiz1" style="display:flex; position: relative; left: 500px; top: 80px;">
        <div id="quiz1box">
          <div id="guessInput1">
            <label for="convergenceOptions">My series will</label>
                    <select name="convergenceOptions" id="convergenceOptions">
              <option value=-1>converge</option>
              <option value=1>diverge</option>
              <option value=0>converge or diverge</option>
            </select>
            <br>
            <label for="arrowOptions">because a_n</label>
              
            <select name="arrowOptions" id="arrowOptions">
              <option value=1>approaches</option>
              <option value=0>does not approach</option>
            </select>
            the value 0.
          </div>
          <div>
            <button id="submitGuess">Submit Guess</button>
            <p id="feedback"></p>
          </div>
        </div>
      </div>
    </div>
    <div id="plot1" style="position:relative; top: -70px;"></div>
  </div>

</div>



<script>
let series1Info;
let series2Info;
document.getElementById("submitGuess").addEventListener("click", function () {
    const divergenceValue = document.getElementById("convergenceOptions").value;
    const arrowValue = document.getElementById("arrowOptions").value;
    const userAnswers = [divergenceValue, arrowValue];
    const correctAnswers = getCorrectAnswers(myFunc);
    const feedback = document.getElementById("feedback");
    feedback.innerHTML = giveFeedback(userAnswers, correctAnswers);
    const continueBtn = document.getElementById("continue");
    if (continueBtn) {
      continueBtn.addEventListener("click", function () { // remove quiz + update title of first plot + rename earlier button...

        document.getElementById("quiz1").remove();
              const plot1label = document.getElementById("plot1-label");
      updatePlot1Label(plot1label, "1/n", correctAnswers);
      });

    }

  });

 
  // store first series text + function
  document.getElementById("seriesInputBtn").addEventListener("click", function () {
    let series1Str = document.getElementById("seriesInput").value;
    let series1Fn= convertSeriesStrToFunc(series1Str);
    series1Info = [series1Str, series1Fn];
    console.log("Series 1 Info: ", series1Info);
    showNext();
  });



function myFunc(n) {
  return 1/n;
}

function updatePlot1Label(plot1label, seriesStr, correctAnswers=-1) {
  if (correctAnswers == -1) { // we just want to set the title to the function
    const textToInsert = `${seriesStr}`;
    plot1label.insertAdjacentHTML("afterbegin", `<div>${textToInsert}</div>`);
    return;
  }
  let divergenceValue = correctAnswers[0];
  let verb;
  if (divergenceValue == 1) {
    verb = `diverge`;
  }
  else {
    verb = 'diverge or converge';
  }
  const textToInsert = `${seriesStr} will <span class="purple">${verb}</span>`;
  plot1label.insertAdjacentHTML("afterbegin", `<div>${textToInsert}</div>`);
}
function getCorrectAnswers(seriesFn) {
  if (isInconclusive(seriesFn)) { // inconclusive test [0], approaching zero [1]
    return [0,1];
  }
  return [1,0];
}
function isInconclusive(seriesFn) {
  if (seriesFn(10000) < 1) {
    return true;
  }
}

function arraysEqual(a, b) {
  return a.length === b.length && a.every((val, i) => val === b[i]);
} 
function giveFeedback(answers, correctAnswers) {
  let userAnswers = answers.map(str => +str); // strings to int
  console.log("user answers: ", userAnswers);
  console.log("correct answers: ", correctAnswers);
  if (userAnswers[0] == -1) { // this will never be correct
    console.log("super wrong");
    return HTMLConvergenceFeedback;
  }
  if (!arraysEqual(userAnswers,correctAnswers)) {
    console.log("wrong");
    return HTMLIncorrectFeedback;
  }
  console.log("correct!");

  return getCorrectFeedback(correctAnswers);
}

function getCorrectFeedback(correctAnswers) {
  let divergenceValue = correctAnswers[0];
  let verb;
  if (divergenceValue == 1) { // ask for inconclsuive 
    verb = `<span class="purple">converges or diverges</span>`;
  }
  else { // ask for divergent
    verb = `<span class="purple">diverges</span>`;
  }
  return `<span class="green">Correct! Now find a series that ${verb} this time.</span><button id="continue">Continue</button>`;
}


const HTMLConvergenceFeedback = `<span class="red">With the Divergence Test, we can never know if our series converges. Try again. </span>`;

const HTMLIncorrectFeedback = `<span class="yellow">Incorrect. Please try again. </span>`;




// showAllTags();
let currentIndex = 0;
// coords = getCoords("1/n");
// plotSeries("plot1", "1/n", coords);
document.addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
              showNext();
          }
        });

document.getElementById("n-slider").addEventListener("input", function () { 
  const n = parseInt(this.value);
  const seriesFn = series1Info[1];
  const value = seriesFn(n);
  document.getElementById("n-value-label").textContent = n;

  document.getElementById("n-value-label").innerHTML = `a<sub>${n}</sub> = <span id="n-value-label">${value.toFixed(4)}</span>`;
  const coords = getCoords(series1Info[0], n);
  plotSeries("plot1", series1Info[0], coords);
});

function showAllTags() {
  const allElements = document.querySelectorAll('*');
  allElements.forEach(el => {
    el.style.opacity = "1";
  });
}
function fadeIn(el) {
    el.style.opacity = "0";    

el.style.animation = "fadeIn 0.6s forwards";
}


function fadeOut(el) {
el.style.opacity = "1";    
el.style.animation = "fadeOut 0.6s forwards";
}


function showNext() {
  currentIndex++;
  console.log(currentIndex);
  if (currentIndex === 1) {
    fadeIn(sentence1);
    MathJax.typeset();
  }

  if (currentIndex === 2) {
    fadeIn(sentence2);
    MathJax.typeset();
  }

  if (currentIndex === 3) {
    fadeIn(sentence3);
    MathJax.typeset();
  }
  if (currentIndex === 4) {
    fadeIn(input1);
    MathJax.typeset();
  }

  if (currentIndex === 5) {
    console.log("here!");
    let coords1 = getCoords(series1Info[0]);
    plotSeries("plot1", series1Info[0], coords1);
    document.getElementById("area1").style.opacity =1;
  }
}

function convertSeriesStrToFunc(seriesStr) {
  let seriesFn;
  try {
    seriesFn = new Function("n", "return " + seriesStr);
    return seriesFn;
  } catch (e) {
    console.error("Invalid series string:", e);
    alert("Invalid series input.");
    return;
  }}

function getCoords(seriesStr,maxN=20) {
  let seriesFn = convertSeriesStrToFunc(seriesStr);
  // try {
  //   // Compile the string into a function of n
  //   seriesFn = new Function("n", "return " + seriesStr);
  // } catch (e) {
  //   console.error("Invalid series string:", e);
  //   alert("Invalid series input.");
  //   return;
  // }

  // Generate values
  const xVals = [];
  const yVals = [];
  for (let n = 1; n <= maxN; n++) {
    try {
      const y = seriesFn(n);
      if (typeof y === 'number' && !isNaN(y)) {
        xVals.push(n);
        yVals.push(y);
      }
    } catch (e) {
      console.error(`Error evaluating series at n=${n}:`, e);
    }
  }
  return [xVals, yVals];
}


function plotSeries(divID, series, coords) {
  Plotly.react(divID, [{
  x: coords[0],
  y: coords[1],
  mode: 'markers',
  type: 'scatter',
  marker: {
    size: 8,
    color: '#00ccff'
  }
}], {
  width: 1000,
  height: 500,
  plot_bgcolor: '#111',
  paper_bgcolor: '#000',
  font: { color: '#00ccff' },
  xaxis: {
    title: { text: 'a_n', font: { color: '#00ccff' } },
    showticklabels: false,
    ticks: '',
    gridcolor: '#333',
    zerolinecolor: '#555',
    linecolor: '#00ccff',
    tickcolor: '#00ccff'
  },
  yaxis: {
    title: { text: 'Value', font: { color: '#00ccff' } },
    showticklabels: false,
    ticks: '',
    gridcolor: '#333',
    zerolinecolor: '#555',
    linecolor: '#00ccff',
    tickcolor: '#00ccff'
  }
});
;
          }
</script>

  </body>
</html>