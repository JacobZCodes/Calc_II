<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Series Animation Example</title>
    <style>
      .hovered {
        text-decoration: underline;
        cursor: help;
        position: relative;
      }

      .hovered::after {
        content: attr(data-tooltip);
        position: absolute;
        background: #333;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        top: 1.5em;
        left: 0;
        font-size: 0.9em;
        white-space: nowrap;
        display: none;
        z-index: 10;
      }

      .hovered:hover::after {
        display: block;
      }

      #sentences {
        margin-top: 1em;
      }

      #user-input {
        margin-top: 1em;
        display: none;
      }
    </style>
    <!-- âœ… MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <h1>Divergence Test</h1>
    <div id="divergence-test" style="display: none"></div>
    <div id="converse" style="display: none"></div>
    <canvas id="stacked-box-canvas" width="400" height="600" style="display:none; border:1px solid #000;"></canvas>
    <script>
      const divergenceTest = document.getElementById('divergence-test');
      divergenceTest.innerHTML = `**If \\(a_n \\not\\to 0\\), then \\(\\sum a_n\\) diverges.** 
				<button onclick="showConverse()">Continue</button>`;
      divergenceTest.style.display = 'block';
      MathJax.typeset();

      function showConverse() {
        const converse = document.getElementById('converse');
        converse.innerHTML = `What this doesn't mean: **If \\(a_n \\to 0\\), then \\(\\sum a_n\\) converges.**
				<button onclick="showDivergenceGraph()">Continue</button>`;
        converse.style.display = 'block';
        MathJax.typeset()
      };

      function showDivergenceGraph() {
  const canvas = document.getElementById('stacked-box-canvas');
  canvas.style.display = 'block';
  const ctx = canvas.getContext('2d');

  // Sequence definition
  const a_n = (n) => Math.pow(2, n - 1);
  const numTerms = 5;
  const boxWidth = 100;
  const baseX = canvas.width / 2 - boxWidth / 2;
  const scaleY = 20;

  // Calculate partial sums
  let partialSums = [];
  let sum = 0;
  for (let i = 1; i <= numTerms; i++) {
    sum += a_n(i);
    partialSums.push(sum);
  }

  // Animation vars
  let i = 0;
  let currentY = canvas.height;

  function drawNextBox() {
    if (i >= partialSums.length) return;

    const height = partialSums[i] * scaleY;
    currentY -= height;

    // Draw box
    ctx.fillStyle = `rgba(0, 100, 255, 0.6)`;
    ctx.fillRect(baseX, currentY, boxWidth, height);

    ctx.strokeStyle = 'black';
    ctx.lineWidth = 1;
    ctx.strokeRect(baseX, currentY, boxWidth, height);
    // Add label
    ctx.fillStyle = 'black';
    ctx.font = '16px sans-serif';
    ctx.fillText(`S_${i + 1} = ${partialSums[i]}`, baseX + 5, currentY + 20);

    i++;
    setTimeout(() => requestAnimationFrame(drawNextBox), 600); // controls animation speed
  }

  drawNextBox();
}

    </script>
  </body>
</html>